<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>게시판</title>
  <style>
    /* 기본 스타일: 중앙 정렬된 컨테이너와 깔끔한 카드 스타일 */
    body{font-family: Arial, "Noto Sans KR", sans-serif; background:#f5f7fb; margin:0; padding:20px}
    .container{max-width:900px; margin:0 auto}
    h1{margin:0 0 16px}
    .card{background:white; border-radius:8px; box-shadow:0 6px 18px rgba(0,0,0,0.06); padding:16px; margin-bottom:16px}

    /* 글 작성 폼 스타일 */
    form#writeForm .row{margin-bottom:8px}
    input[type=text], textarea{width:100%; padding:10px; border-radius:6px; border:1px solid #ddd; box-sizing:border-box}
    textarea{min-height:120px; resize:vertical}
    button{padding:10px 14px; border-radius:6px; border:0; background:#2563eb; color:white; cursor:pointer}
    button.secondary{background:#6b7280}

    /* 게시글 목록 */
    .post-list{list-style:none; padding:0; margin:0}
    .post-item{padding:12px; border-bottom:1px solid #f0f2f5; display:flex; justify-content:space-between; align-items:center}
    .post-item .meta{color:#6b7280; font-size:13px}

    /* 반응형 */
    @media (max-width:600px){body{padding:12px}}
  </style>
</head>
<body>
  <div class="container">
    <h1>간게시판</h1>

    <!-- 글 작성 영역: 사용자가 제목과 내용을 입력하면 로컬 저장소에 저장됩니다. -->
    <div class="card">
      <form id="writeForm">
        <div class="row">
          <!-- 제목 입력 -->
          <label for="title">제목</label>
          <input id="title" name="title" type="text" placeholder="제목을 입력하세요" required>
        </div>
        <div class="row">
          <!-- 내용 입력 -->
          <label for="content">내용</label>
          <textarea id="content" name="content" placeholder="내용을 입력하세요" required></textarea>
        </div>
        <div class="row" style="text-align:right">
          <!-- 작성 및 취소 버튼 -->
          <button type="submit">작성</button>
          <button type="button" id="clearBtn" class="secondary">초기화</button>
        </div>
      </form>
    </div>

    <!-- 게시글 목록 영역: 저장된 글들을 보여줍니다. -->
    <div class="card">
      <h2>글 목록</h2>
      <ul id="postList" class="post-list"></ul>
      <!-- 페이징이나 검색은 나중에 추가할 수 있습니다. -->
    </div>

    <!-- 모달(간단한 상세보기용): JS로 표시/숨김 제어 -->
    <div id="modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.4); align-items:center; justify-content:center">
      <div style="background:white; width:90%; max-width:720px; border-radius:8px; padding:16px; position:relative">
        <button id="closeModal" style="position:absolute; right:12px; top:12px; border:0; background:#ef4444; color:white; padding:6px 8px; border-radius:6px">닫기</button>
        <h3 id="modalTitle"></h3>
        <div class="meta" id="modalMeta" style="color:#6b7280; font-size:13px"></div>
        <p id="modalContent" style="white-space:pre-wrap; margin-top:12px"></p>
        <div style="text-align:right; margin-top:12px">
          <button id="editBtn" class="secondary">수정</button>
          <button id="deleteBtn">삭제</button>
        </div>
      </div>
    </div>

  </div>

  <script>
    /*
      설명 (요약)
      - 이 파일은 서버가 없이 로컬에서 동작하는 간단한 게시판입니다.
      - 데이터를 브라우저의 localStorage에 JSON으로 저장합니다.
      - 실제 서비스용으로는 보안(입력 검증, XSS 방지), 백엔드/DB 연동이 필요합니다.
    */

    // --- 유틸리티 함수들 ---
    const $ = (sel) => document.querySelector(sel);
    const $all = (sel) => document.querySelectorAll(sel);

    // 현재 시간 문자열 생성: YYYY-MM-DD HH:MM:SS
    function nowString(){
      const d = new Date();
      const pad = (n)=> String(n).padStart(2,'0');
      return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
    }

    // 로컬스토리지 키
    const STORAGE_KEY = 'simple_board_posts_v1';

    // 저장된 포스트 불러오기(없으면 빈 배열 반환)
    function loadPosts(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : [];
      }catch(e){
        console.error('loadPosts error', e);
        return [];
      }
    }

    // 포스트 저장하기(전체 배열을 덮어씀)
    function savePosts(posts){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(posts));
    }

    // 새로운 포스트 생성 및 저장
    function addPost(title, content){
      const posts = loadPosts();
      const id = posts.length ? posts[posts.length-1].id + 1 : 1; // 간단한 id 부여 방식
      const post = {id, title, content, created_at: nowString()};
      posts.push(post);
      savePosts(posts);
      return post;
    }

    // id로 포스트 찾기
    function findPost(id){
      const posts = loadPosts();
      return posts.find(p=>p.id===id);
    }

    // id로 포스트 삭제
    function deletePost(id){
      let posts = loadPosts();
      posts = posts.filter(p=>p.id!==id);
      savePosts(posts);
    }

    // id로 포스트 수정
    function updatePost(id, newTitle, newContent){
      const posts = loadPosts();
      const p = posts.find(x=>x.id===id);
      if(p){ p.title = newTitle; p.content = newContent; }
      savePosts(posts);
    }

    // 게시글 목록을 화면에 렌더링
    function renderList(){
      const listEl = $('#postList');
      listEl.innerHTML = '';
      const posts = loadPosts().slice().reverse(); // 최신순 표시 (reverse)

      if(posts.length===0){
        listEl.innerHTML = '<li style="padding:12px; color:#6b7280">작성된 글이 없습니다.</li>';
        return;
      }

      for(const p of posts){
        const li = document.createElement('li');
        li.className = 'post-item';
        li.innerHTML = `
          <div style="flex:1; cursor:pointer" data-id="${p.id}">
            <strong>${escapeHtml(p.title)}</strong>
            <div class="meta">#${p.id} · ${p.created_at}</div>
          </div>
          <div style="margin-left:12px">
            <button data-action="view" data-id="${p.id}" class="secondary">열기</button>
          </div>
        `;
        listEl.appendChild(li);
      }
    }

    // 간단한 XSS 방지: 텍스트를 HTML 이스케이프
    function escapeHtml(text){
      return String(text)
        .replace(/&/g,'&amp;')
        .replace(/</g,'&lt;')
        .replace(/>/g,'&gt;')
        .replace(/"/g,'&quot;')
        .replace(/'/g,'&#39;');
    }

    // --- 이벤트 연결 ---
    document.addEventListener('DOMContentLoaded', ()=>{
      renderList();

      // 글 작성 처리
      $('#writeForm').addEventListener('submit', (e)=>{
        e.preventDefault();
        const title = $('#title').value.trim();
        const content = $('#content').value.trim();
        if(!title || !content){ alert('제목과 내용을 모두 입력하세요.'); return; }

        addPost(title, content);
        // 입력란 초기화
        $('#title').value = '';
        $('#content').value = '';
        renderList();
      });

      // 초기화 버튼
      $('#clearBtn').addEventListener('click', ()=>{
        if(confirm('작성중인 내용을 지우시겠어요?')){
          $('#title').value = '';
          $('#content').value = '';
        }
      });

      // 목록에서 열기 버튼 누르면 모달 표시
      $('#postList').addEventListener('click', (e)=>{
        const btn = e.target.closest('button[data-action]');
        if(!btn) return;
        const id = Number(btn.dataset.id);
        if(btn.dataset.action === 'view'){
          const p = findPost(id);
          if(!p) return alert('글을 찾을 수 없습니다.');
          $('#modalTitle').textContent = p.title;
          $('#modalMeta').textContent = `#${p.id} · ${p.created_at}`;
          $('#modalContent').textContent = p.content;
          // 버튼에 데이터 연결
          $('#deleteBtn').dataset.id = id;
          $('#editBtn').dataset.id = id;
          $('#modal').style.display = 'flex';
        }
      });

      // 모달 닫기
      $('#closeModal').addEventListener('click', ()=>{ $('#modal').style.display = 'none'; });

      // 삭제 버튼
      $('#deleteBtn').addEventListener('click', function(){
        const id = Number(this.dataset.id);
        if(!confirm('정말 삭제하시겠어요?')) return;
        deletePost(id);
        $('#modal').style.display = 'none';
        renderList();
      });

      // 수정 버튼: 모달을 닫고, 수정 모드를 띄우기 (여기서는 간단히 기존 값을 폼에 채워 수정토록 함)
      $('#editBtn').addEventListener('click', function(){
        const id = Number(this.dataset.id);
        const p = findPost(id);
        if(!p) return alert('글을 찾을 수 없습니다.');
        // 폼에 값 채우기
        $('#title').value = p.title;
        $('#content').value = p.content;
        // 모달 닫기
        $('#modal').style.display = 'none';

        // 제출 시 기존 글을 업데이트하도록 일시적으로 처리
        const form = $('#writeForm');
        const originalHandler = form.onsubmit;

        // 새 submit handler
        form.onsubmit = function(ev){
          ev.preventDefault();
          const newTitle = $('#title').value.trim();
          const newContent = $('#content').value.trim();
          if(!newTitle || !newContent){ alert('제목과 내용을 모두 입력하세요.'); return; }
          updatePost(id, newTitle, newContent);
          // 폼 리셋
          $('#title').value = '';
          $('#content').value = '';
          // 복원
          form.onsubmit = originalHandler;
          renderList();
        };

        // 사용자가 수정 취소할 수 있도록 clear 버튼을 누르면 handler 복원
        $('#clearBtn').addEventListener('click', function restore(){
          form.onsubmit = originalHandler;
          // 한 번만 실행되도록 제거
          this.removeEventListener('click', restore);
        });
      });

    });

  </script>
</body>
</html>
